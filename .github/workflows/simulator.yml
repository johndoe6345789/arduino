name: Simulator CI

on:
  push:
    paths:
      - 'simulator/**'
      - '.github/workflows/simulator.yml'
  pull_request:
    paths:
      - 'simulator/**'
      - '.github/workflows/simulator.yml'

jobs:
  backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7
      - name: Install build tools
        run: |
          sudo apt-get update
          sudo apt-get install -y ninja-build cmake python3-pip
          python3 -m pip install conan==2.4.1
      - name: Configure Conan
        working-directory: simulator/backend
        run: conan profile detect --force
      - name: Install dependencies
        working-directory: simulator/backend
        run: conan install . --output-folder=build --build=missing
      - name: Configure CMake
        working-directory: simulator/backend
        run: cmake --preset default
      - name: Build
        working-directory: simulator/backend
        run: cmake --build --preset default
      - name: Run tests
        working-directory: simulator/backend
        run: ctest --preset default

  frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7
      - uses: actions/setup-node@39370e3970a6d050c480ffad4ff0ed4d3fdee5af # v4.1.0
        with:
          node-version: 20
          cache: npm
          cache-dependency-path: simulator/frontend/package-lock.json
      - name: Install dependencies
        working-directory: simulator/frontend
        run: npm ci --ignore-scripts
      - name: Lint
        working-directory: simulator/frontend
        run: npm run lint
      - name: Build
        working-directory: simulator/frontend
        run: npm run build
